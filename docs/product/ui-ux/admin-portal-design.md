# 🖥️ 管理後台介面設計

本文件詳細描述「餐廳會員管理系統」管理後台的所有頁面佈局、互動設計和使用者體驗。

---

## 📋 目錄

1. [登入頁面](#登入頁面)
2. [儀表板](#儀表板)
3. [會員管理](#會員管理)
4. [交易管理](#交易管理)
5. [問卷管理](#問卷管理)
6. [積分規則管理](#積分規則管理)
7. [iChef 匯入](#ichef-匯入)
8. [共用元件](#共用元件)

---

## 🎯 設計原則

### **1. 效率優先**
- 常用功能一鍵直達
- 快捷鍵支援（Ctrl+K 全域搜尋）
- 批次操作減少重複動作

### **2. 資料視覺化**
- 關鍵指標儀表板
- 圖表輔助決策
- 即時數據更新

### **3. 權限清晰**
- 依角色顯示功能
- 受限操作明確提示
- 操作日誌可追蹤

---

## 登入頁面

### **頁面佈局**

```
┌────────────────────────────────────────────────────────┐
│                                                        │
│                    [Logo]                              │
│               餐廳會員管理系統                         │
│                                                        │
│         ┌──────────────────────────────┐              │
│         │                              │              │
│         │   🔐 管理後台登入            │              │
│         │                              │              │
│         │   ┌──────────────────────┐   │              │
│         │   │                      │   │              │
│         │   │  [Google 圖示]       │   │              │
│         │   │  使用 Google 帳號登入 │   │              │
│         │   │                      │   │              │
│         │   └──────────────────────┘   │              │
│         │                              │              │
│         │   僅授權人員可登入            │              │
│         │                              │              │
│         └──────────────────────────────┘              │
│                                                        │
│              © 2025 Restaurant Name                    │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### **互動流程**

1. **點擊「使用 Google 帳號登入」**
   - 跳轉至 Google OAuth2 授權頁面
   - 用戶選擇 Google 帳號並授權

2. **授權成功**
   - 跳轉至 `/callback` 處理 token
   - 檢查 email 是否在授權清單
   - 分配角色（Admin/User/Guest）

3. **授權失敗**
   - 顯示錯誤訊息：「您的帳號未授權訪問此系統，請聯繫管理員」
   - 提供客服聯絡方式

### **設計規範**

- **色彩**: 白色背景 + 品牌主色（藍色按鈕）
- **按鈕**: 大尺寸（最小 48px 高度）易於點擊
- **訊息**: 清楚說明「僅授權人員可登入」

---

## 儀表板

### **頁面佈局**

```
┌────────────────────────────────────────────────────────────────┐
│ [BP] Bar Pun                      [通知] [個人選單]            │
├─────────────┬──────────────────────────────────────────────────┤
│             │  Line 用戶管理                                   │
│  側邊欄     │                                                  │
│ (240px)     │  本月統計 (2025/01)                              │
│             │  ┌──────┬──────┬──────┬──────┐                  │
│ Line 用戶   │  │ 新增  │ 交易  │ 發放  │ 問卷  │                  │
│  管理       │  │ 會員  │ 筆數  │ 積分  │ 完成  │                  │
│             │  ├──────┼──────┼──────┼──────┤                  │
│ 點數管理    │  │ 128  │ 1,523│15,487│  456 │                  │
│             │  │ +12% │  +8% │ +15% │  30% │                  │
│ 消費紀錄 ▼  │  └──────┴──────┴──────┴──────┘                  │
│  Line 發票  │                                                  │
│  iChef ▼    │  本週趨勢圖                                      │
│   導入歷史  │  ┌──────────────────────────────┐                │
│   發票明細  │  │                              │                │
│             │  │  [折線圖：每日新增會員]      │                │
│ 問卷管理 ▼  │  │                              │                │
│  問卷清單   │  └──────────────────────────────┘                │
│  問卷回覆   │                                                  │
│             │  待處理事項                                      │
│ 管理員      │  • ⚠️  待驗證交易: 23 筆 → [查看]                │
│             │  • ℹ️  未匹配發票: 5 筆 → [查看]                 │
│ ─────────   │  • ✅ 系統運行正常                                │
│ [登出]      │                                                  │
│             │                                                  │
└─────────────┴──────────────────────────────────────────────────┘
```

### **關鍵指標卡片**

每個指標卡片包含：
- **主要數字**: 大字體顯示（24px）
- **標籤**: 清楚說明指標（16px）
- **趨勢**: 與上期比較（+12%，綠色向上箭頭）
- **圖示**: 輔助識別

### **趨勢圖表**

- **圖表類型**: 折線圖或柱狀圖
- **時間範圍**: 可切換（本週/本月/本季）
- **互動**: 滑鼠懸停顯示詳細數據

---

## 會員管理

### **會員列表頁**

```
┌────────────────────────────────────────────────────────┐
│  👥 會員管理                                           │
├────────────────────────────────────────────────────────┤
│                                                        │
│  🔍 [搜尋：暱稱或手機號碼______]  [篩選▼]  [匯出]     │
│                                                        │
├────┬────────┬────────┬──────┬──────┬────────┬────────┤
│ #  │ 暱稱    │ 手機    │ 累積  │ 交易  │ 註冊日期│ 操作    │
│    │        │        │ 積分  │ 筆數  │        │        │
├────┼────────┼────────┼──────┼──────┼────────┼────────┤
│ 1  │ 王小明  │0912*** │ 125  │  48  │01/05   │[查看]  │
│ 2  │ 李美麗  │0987*** │  87  │  32  │01/03   │[查看]  │
│ 3  │ 張大華  │0923*** │  65  │  25  │12/28   │[查看]  │
│    │        │        │      │      │        │        │
└────┴────────┴────────┴──────┴──────┴────────┴────────┘

  第 1 頁，共 10 頁    [<上一頁]  [下一頁>]
```

### **搜尋與篩選**

**搜尋框**:
- 支援模糊搜尋（暱稱、手機號碼部分匹配）
- 即時搜尋（輸入即過濾）
- 清除按鈕（X 圖示）

**篩選選項**:
```
篩選 ▼
├─ 註冊日期
│  ├─ 今天
│  ├─ 本週
│  ├─ 本月
│  └─ 自訂範圍
├─ 積分範圍
│  ├─ 0-50
│  ├─ 51-100
│  ├─ 101-200
│  └─ 200+
└─ 交易筆數
   ├─ 1-10
   ├─ 11-30
   └─ 30+
```

### **會員詳情頁**

```
┌────────────────────────────────────────────────────────┐
│  ← 返回列表    會員詳情 - 王小明                       │
├────────────────────────────────────────────────────────┤
│                                                        │
│  基本資訊                     積分資訊                 │
│  ┌──────────────────┐       ┌──────────────────┐      │
│  │ LINE ID          │       │ 累積賺取: 125 點 │      │
│  │ Uxxxxxxxxxxxxx   │       │ 已使用: 0 點     │      │
│  │                  │       │ 可用餘額: 125 點 │      │
│  │ 暱稱: 王小明      │       │                  │      │
│  │ 手機: 0912345678 │       │ 完成問卷: 35 次  │      │
│  │ 註冊: 2025/01/05 │       │ 問卷獎勵: 35 點  │      │
│  └──────────────────┘       └──────────────────┘      │
│                                                        │
│  ┌──────────────────────────────────────────────┐    │
│  │  交易歷史 (48 筆)            [篩選▼] [匯出]  │    │
│  ├────┬──────────┬──────┬──────┬──────┬────────┤    │
│  │ #  │ 發票號碼  │ 日期  │ 金額  │ 積分  │ 狀態    │    │
│  ├────┼──────────┼──────┼──────┼──────┼────────┤    │
│  │ 1  │AB-12345678│01/07 │ 250  │  2   │✅已驗證 │    │
│  │ 2  │AB-12345677│01/05 │ 180  │  1   │✅已驗證 │    │
│  │ 3  │AB-12345676│01/03 │ 320  │  3   │⏳待驗證 │    │
│  └────┴──────────┴──────┴──────┴──────┴────────┘    │
│                                                        │
│  ┌──────────────────────────────────────────────┐    │
│  │  問卷回應 (35 筆)                [查看統計]  │    │
│  ├────┬────────────────┬──────┬────────────────┤    │
│  │ #  │ 問卷標題        │ 日期  │ 操作            │    │
│  ├────┼────────────────┼──────┼────────────────┤    │
│  │ 1  │ 用餐滿意度調查  │01/07 │ [查看回應]     │    │
│  │ 2  │ 用餐滿意度調查  │01/05 │ [查看回應]     │    │
│  └────┴────────────────┴──────┴────────────────┘    │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### **設計重點**

- **分組顯示**: 基本資訊、積分資訊、歷史記錄分開
- **資料表格**: 可排序、分頁
- **狀態標示**: 使用顏色和圖示（✅綠色、⏳黃色、❌紅色）
- **隱私保護**: 手機號碼可選擇顯示完整或遮罩

---

## 交易管理

### **交易列表頁**

```
┌────────────────────────────────────────────────────────┐
│  💳 交易管理                                           │
├────────────────────────────────────────────────────────┤
│                                                        │
│  🔍 [搜尋：發票號碼__]  [狀態▼全部] [日期範圍▼]  [匯出│
│                                                        │
├────┬──────────┬────────┬──────┬──────┬──────┬────────┤
│ #  │ 發票號碼  │ 會員    │ 日期  │ 金額  │ 積分  │ 狀態    │
├────┼──────────┼────────┼──────┼──────┼──────┼────────┤
│ 1  │AB-12345678│王小明  │01/07 │ 250  │  2   │✅已驗證 │
│ 2  │AB-12345677│李美麗  │01/07 │ 180  │  1   │⏳待驗證 │
│ 3  │AB-12345676│張大華  │01/06 │ 320  │  3   │❌作廢   │
│    │          │        │      │      │      │  [編輯] │
└────┴──────────┴────────┴──────┴──────┴──────┴────────┘

  顯示 1-10，共 1,523 筆    [<]  [>]
```

### **狀態篩選**

```
狀態 ▼
├─ 全部 (1,523)
├─ ✅ 已驗證 (1,487)
├─ ⏳ 待驗證 (31)
└─ ❌ 作廢 (5)
```

### **交易編輯對話框**

```
┌────────────────────────────────────┐
│  編輯交易狀態                      │
├────────────────────────────────────┤
│                                    │
│  發票號碼: AB-12345677             │
│  會員: 李美麗 (0987***678)         │
│  消費日期: 2025/01/07              │
│  消費金額: NT$ 180                 │
│                                    │
│  ──────────────────────            │
│                                    │
│  目前狀態: ⏳ 待驗證                │
│                                    │
│  更新狀態:                         │
│  ○ ✅ 已驗證（將計入積分）         │
│  ● ❌ 作廢（將扣除已計入的積分）   │
│                                    │
│  備註（可選）:                     │
│  [________________]                │
│                                    │
│  ⚠️  注意：                        │
│  變更狀態將自動重新計算用戶積分     │
│                                    │
│  [取消]          [確認更新]        │
│                                    │
└────────────────────────────────────┘
```

### **批次操作**

- **多選框**: 允許選擇多筆交易
- **批次動作**: 批次驗證、批次作廢
- **確認對話框**: 顯示影響筆數和結果預覽

---

## 問卷管理

### **問卷列表頁**

```
┌────────────────────────────────────────────────────────┐
│  📋 問卷管理                    [+ 建立新問卷]          │
├────────────────────────────────────────────────────────┤
│                                                        │
├────┬────────────┬──────┬──────┬──────┬──────┬────────┤
│ #  │ 問卷標題    │ 題數  │ 回應  │ 完成率│ 狀態  │ 操作    │
├────┼────────────┼──────┼──────┼──────┼──────┼────────┤
│ 1  │用餐滿意度..│  5   │ 456  │ 30%  │🟢啟用 │[查看]  │
│    │            │      │      │      │      │[編輯]  │
│    │            │      │      │      │      │[停用]  │
│ 2  │服務品質調查│  3   │ 123  │ 25%  │⚪停用 │[查看]  │
│    │            │      │      │      │      │[啟用]  │
│    │            │      │      │      │      │[刪除]  │
└────┴────────────┴──────┴──────┴──────┴──────┴────────┘
```

### **建立/編輯問卷頁**

```
┌────────────────────────────────────────────────────────┐
│  ← 返回    建立新問卷                                  │
├────────────────────────────────────────────────────────┤
│                                                        │
│  基本資訊                                              │
│  ┌──────────────────────────────────────────────┐    │
│  │ 問卷標題 *                                    │    │
│  │ [用餐滿意度調查__________________________]    │    │
│  │                                              │    │
│  │ 問卷說明                                      │    │
│  │ [感謝您的光臨，請協助填寫以下問卷...]        │    │
│  │ [____________________________________]        │    │
│  └──────────────────────────────────────────────┘    │
│                                                        │
│  問題設定                           [+ 新增問題]       │
│  ┌──────────────────────────────────────────────┐    │
│  │ 問題 1                     [↑] [↓] [✕ 刪除]  │    │
│  ├──────────────────────────────────────────────┤    │
│  │ 問題文字 *                                    │    │
│  │ [您對今日的用餐體驗滿意嗎？___________]      │    │
│  │                                              │    │
│  │ 題型:  ● 評分題 (1-5星)                     │    │
│  │        ○ 選擇題                              │    │
│  │        ○ 文字題                              │    │
│  │                                              │    │
│  │ ☑ 必填                                       │    │
│  └──────────────────────────────────────────────┘    │
│                                                        │
│  ┌──────────────────────────────────────────────┐    │
│  │ 問題 2                     [↑] [↓] [✕ 刪除]  │    │
│  ├──────────────────────────────────────────────┤    │
│  │ 問題文字 *                                    │    │
│  │ [您最喜歡哪道菜？_____________________]      │    │
│  │                                              │    │
│  │ 題型:  ○ 評分題                              │    │
│  │        ○ 選擇題                              │    │
│  │        ● 文字題                              │    │
│  │                                              │    │
│  │ ☐ 必填                                       │    │
│  └──────────────────────────────────────────────┘    │
│                                                        │
│                         [取消]  [儲存草稿]  [發布]    │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### **問卷統計頁**

```
┌────────────────────────────────────────────────────────┐
│  ← 返回    問卷統計 - 用餐滿意度調查                   │
├────────────────────────────────────────────────────────┤
│                                                        │
│  總覽                                                  │
│  ┌────────┬────────┬────────┬────────┐              │
│  │ 發送數  │ 回應數  │ 完成率  │ 平均分  │              │
│  ├────────┼────────┼────────┼────────┤              │
│  │ 1,520  │  456   │  30%   │  4.2   │              │
│  └────────┴────────┴────────┴────────┘              │
│                                                        │
│  問題 1：您對今日的用餐體驗滿意嗎？                     │
│  ┌──────────────────────────────────────────────┐    │
│  │  平均評分: 4.2 / 5.0                         │    │
│  │                                              │    │
│  │  5★ ████████████████████  65% (297人)       │    │
│  │  4★ ███████████  25% (114人)                │    │
│  │  3★ ████  8% (36人)                         │    │
│  │  2★ █  1.5% (7人)                           │    │
│  │  1★  0.5% (2人)                             │    │
│  └──────────────────────────────────────────────┘    │
│                                                        │
│  問題 2：您最喜歡哪道菜？                               │
│  ┌──────────────────────────────────────────────┐    │
│  │  文字回應 (456 筆)              [查看全部]   │    │
│  │                                              │    │
│  │  常見關鍵字:                                  │    │
│  │  • 牛肉麵 (87 次)                            │    │
│  │  • 排骨飯 (65 次)                            │    │
│  │  • 滷肉飯 (54 次)                            │    │
│  └──────────────────────────────────────────────┘    │
│                                                        │
│                              [匯出報表 (Excel)]        │
│                                                        │
└────────────────────────────────────────────────────────┘
```

---

## 積分規則管理

### **規則列表頁**

```
┌────────────────────────────────────────────────────────┐
│  🎯 積分轉換規則管理              [+ 新增規則]          │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ⚠️  重要提醒                                          │
│  規則變更後需執行 make recalculate-points 重算積分      │
│  建議在離峰時段執行（如凌晨 3:00）                      │
│                                                        │
├────┬──────────┬──────────┬──────┬──────┬──────────────┤
│ #  │ 開始日期  │ 結束日期  │ 轉換率│ 狀態  │ 操作          │
├────┼──────────┼──────────┼──────┼──────┼──────────────┤
│ 1  │1140101   │1140120   │ 50   │🟢啟用 │[編輯][刪除]  │
│    │(促銷期)  │          │(50=1)│      │              │
│ 2  │1140101   │-         │ 100  │⚪停用 │[啟用][編輯]  │
│    │          │          │(100=1)│     │[刪除]        │
└────┴──────────┴──────────┴──────┴──────┴──────────────┘

  預設規則: 100 元 = 1 點
```

### **新增/編輯規則對話框**

```
┌────────────────────────────────────┐
│  新增積分轉換規則                  │
├────────────────────────────────────┤
│                                    │
│  規則名稱（可選）:                 │
│  [春節促銷活動_______________]     │
│                                    │
│  有效期間 *                        │
│  開始日期 (ROC):                   │
│  [1140101______]                   │
│  (民國年月日，格式：yyymmdd)       │
│                                    │
│  結束日期 (可選):                  │
│  [1140120______]                   │
│  (留空表示永久有效)                │
│                                    │
│  轉換率 *                          │
│  每 [50_] 元 = 1 點                │
│  (範圍：1-1000)                    │
│                                    │
│  ☑ 立即啟用                        │
│                                    │
│  ⚠️  注意事項：                    │
│  • 日期不可與現有規則重疊           │
│  • 儲存後需手動執行積分重算         │
│  • 重算期間會鎖定用戶表 30-60 秒    │
│                                    │
│  [取消]          [儲存]            │
│                                    │
└────────────────────────────────────┘
```

---

## iChef 匯入

### **檔案上傳頁**

```
┌────────────────────────────────────────────────────────┐
│  📥 iChef 發票資料匯入                                 │
├────────────────────────────────────────────────────────┤
│                                                        │
│  步驟 1：選擇檔案                                       │
│  ┌──────────────────────────────────────────────┐    │
│  │                                              │    │
│  │          拖曳 Excel 檔案到此處               │    │
│  │              或                              │    │
│  │         [點擊選擇檔案]                       │    │
│  │                                              │    │
│  │   支援格式：.xlsx, .xls                      │    │
│  │   檔案大小：最大 10MB                        │    │
│  │                                              │    │
│  └──────────────────────────────────────────────┘    │
│                                                        │
│  已選擇：結帳紀錄_2025-01-01~01-07.xlsx (2.3 MB)       │
│                                                        │
│  步驟 2：確認匯入                                       │
│  ⚠️  匯入前請確認：                                    │
│  • 檔案包含完整的發票資料（號碼、日期、金額）          │
│  • 發票日期格式正確                                    │
│  • 重複發票將自動跳過                                  │
│                                                        │
│                    [取消]  [開始匯入]                  │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### **匯入進度顯示**

```
┌────────────────────────────────────┐
│  正在匯入中，請稍候...              │
├────────────────────────────────────┤
│                                    │
│  ████████████░░░░░░  65%           │
│                                    │
│  已處理：650 / 1000 筆              │
│  預估剩餘時間：15 秒                │
│                                    │
└────────────────────────────────────┘
```

### **匯入結果頁**

```
┌────────────────────────────────────────────────────────┐
│  ✅ 匯入完成                                           │
├────────────────────────────────────────────────────────┤
│                                                        │
│  匯入摘要                                              │
│  ┌────────┬────────┬────────┬────────┐              │
│  │ 總筆數  │ 成功匹配│ 未匹配  │ 重複    │              │
│  ├────────┼────────┼────────┼────────┤              │
│  │ 1,000  │  950   │   45   │   5    │              │
│  └────────┴────────┴────────┴────────┘              │
│                                                        │
│  詳細說明                                              │
│  • 成功匹配 950 筆：與會員掃描記錄匹配，已更新為「已驗證」
│  • 未匹配 45 筆：無對應會員掃描記錄                     │
│  • 重複 5 筆：已匯入過，自動跳過                       │
│                                                        │
│  📊 受影響用戶                                         │
│  • 積分已重算：328 位會員                              │
│  • 平均處理時間：2.3 秒                                │
│                                                        │
│           [查看詳細記錄]  [匯入新檔案]  [返回]        │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### **匯入歷史列表**

```
┌────────────────────────────────────────────────────────┐
│  📥 匯入歷史                                           │
├────────────────────────────────────────────────────────┤
│                                                        │
├────┬────────────┬──────┬──────┬──────┬──────┬────────┤
│ #  │ 檔案名稱    │ 總筆  │ 匹配  │ 重複  │ 時間  │ 操作    │
├────┼────────────┼──────┼──────┼──────┼──────┼────────┤
│ 1  │結帳紀錄_01..│1,000 │  950 │   5  │01/08 │[查看]  │
│ 2  │結帳紀錄_12..│  856 │  820 │   2  │01/01 │[查看]  │
│ 3  │結帳紀錄_12..│  742 │  701 │   8  │12/25 │[查看]  │
└────┴────────────┴──────┴──────┴──────┴──────┴────────┘
```

---

## 共用元件

### **頁面標題列**

```
┌────────────────────────────────────────────────────────┐
│  [頁面圖示] 頁面標題         [主要操作按鈕]  [次要按鈕] │
│  ├─ 子標題或麵包屑                                      │
└────────────────────────────────────────────────────────┘
```

### **資料表格**

**基本表格**:
- 斑馬紋（zebra striping）提升可讀性
- 滑鼠懸停高亮當前行
- 可排序欄位顯示排序圖示
- 操作欄固定在右側

**分頁控制**:
```
顯示 1-10，共 523 筆    每頁 [10▼] 筆    [<] 1 2 3 ... 53 [>]
```

### **空狀態**

```
┌────────────────────────────────────┐
│                                    │
│            [插畫圖示]              │
│                                    │
│         尚無資料                   │
│                                    │
│   開始使用 [主要操作] 建立第一筆資料│
│                                    │
└────────────────────────────────────┘
```

### **載入狀態**

```
┌────────────────────────────────────┐
│                                    │
│          ⏳ 載入中...              │
│                                    │
│        [旋轉載入動畫]              │
│                                    │
└────────────────────────────────────┘
```

### **成功/錯誤訊息（Toast）**

**成功訊息**:
```
┌────────────────────────────────────┐
│ ✅ 操作成功                        │
│ 資料已成功儲存                      │
└────────────────────────────────────┘
(右上角浮動，3秒後自動消失)
```

**錯誤訊息**:
```
┌────────────────────────────────────┐
│ ❌ 操作失敗                        │
│ 請檢查輸入格式後重試                │
│ [查看詳情]                         │
└────────────────────────────────────┘
(右上角浮動，需手動關閉)
```

---

## 響應式設計

### **斷點**

- **Desktop**: ≥ 1200px（完整佈局）
- **Tablet**: 768px - 1199px（側邊欄可收合）
- **Mobile**: < 768px（漢堡選單）

### **平板佈局**

```
┌────────────────────────────────────┐
│ [≡] Logo         [通知] [個人]     │
├────────────────────────────────────┤
│  📊 儀表板                         │
│                                    │
│  (內容區域佔滿全寬)                │
│                                    │
└────────────────────────────────────┘

點擊 [≡] 彈出側邊欄：

┌─────────┬──────────────────────────┐
│         │                          │
│ 📊 儀表板│  (內容區域)              │
│ 👥 會員  │                          │
│ 💳 交易  │                          │
│ ...     │                          │
│         │                          │
└─────────┴──────────────────────────┘
```

---

## 🔗 相關文件

- [US-006: 管理後台](../stories/US-006-admin-portal.md)
- [ADMIN_API.md](../../../ADMIN_API.md) - 管理後台 API 規格
- [FRONTEND_INTEGRATION.md](../../../FRONTEND_INTEGRATION.md) - 前端整合指南
- [Ant Design 5](https://ant.design/) - UI 元件庫
- [Refine v5](https://refine.dev/) - 管理後台框架

---

**文件版本**: V3.1
**最後更新**: 2025-01-08
**維護者**: Product Team & UI/UX Designer
