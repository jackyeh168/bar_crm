# 實施路線圖 (Implementation Roadmap)

> **版本**: 1.0
> **最後更新**: 2025-01-08

---

## 1. 實施建議

### **1.1 開發優先級**

1. **第一階段**: 核心域完善
   - 優先實現積分管理上下文
   - 建立完整的積分計算與重算邏輯
   - 確保領域模型堅實

2. **第二階段**: 核心流程實現
   - 實現發票處理流程
   - 完善 iChef 整合邏輯
   - 實現問卷系統

3. **第三階段**: 未來功能準備
   - 設計積分兌換架構
   - 準備優惠券系統
   - 規劃會員等級制度

### **1.2 技術實施要點**

#### **依賴注入**
- 使用 Uber FX 進行依賴注入
- 每個上下文一個 FX Module
- 清晰的依賴圖譜

#### **事件驅動**
- 使用外部消息隊列 (初期可用內存事件總線)
- 領域事件命名規範: `{Aggregate}{Action}Event`
- 異步處理非關鍵路徑

#### **測試策略**
- 領域層: 單元測試 (90%+ 覆蓋率)
- 應用層: 集成測試 (用例測試)
- 展示層: E2E 測試

#### **文檔維護**
- 隨代碼演進更新架構文檔
- 使用 ADR (Architecture Decision Records)
- 維護統一語言詞彙表

---

## 2. 未來擴展考量

### **2.1 V3.2: 積分兌換功能**

**影響的上下文**:
- 積分管理: 新增 `DeductPoints` 業務邏輯
- 新增上下文: 兌換管理 (Redemption Context)

**架構變更**:
```
新增聚合: RedemptionCatalog, Redemption
新增領域事件: PointsDeducted, RedemptionConfirmed
新增業務流程: 兌換申請 → 積分扣除 → 兌換確認
```

### **2.2 V3.3: 優惠券系統**

**影響的上下文**:
- 新增上下文: 優惠券管理 (Coupon Context)
- 發票處理: 新增優惠券核銷邏輯

**架構變更**:
```
新增聚合: Coupon, CouponUsage
新增上下文關係: 發票處理 → 優惠券管理 (事件驅動)
```

### **2.3 V3.4: 會員等級制度**

**影響的上下文**:
- 會員管理: 新增會員等級邏輯
- 積分管理: 等級影響積分轉換率

**架構變更**:
```
會員管理新增: MemberTier (Value Object)
積分管理調整: 計算積分時考慮會員等級加成
```

### **2.4 技術演進路線圖**

#### **階段 1: 單體應用 (當前)**
- 所有上下文在同一進程
- 共享資料庫
- 異步事件總線

#### **階段 2: 模組化單體**
- 按上下文劃分模組
- 外部消息隊列 (RabbitMQ/Kafka)
- 準備微服務拆分

#### **階段 3: 微服務架構**
- 核心域獨立部署 (積分管理)
- 非同步通訊 (消息隊列)
- 每個上下文獨立資料庫

```
┌────────────────────────────────────────────────────────┐
│                  API Gateway                           │
└────────────────────────────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
┌───────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐
│ 積分管理服務  │ │ 發票處理服務 │ │ 會員管理服務 │
│   (核心域)   │ │   (核心域)   │ │   (支撐域)   │
└──────┬───────┘ └──────┬──────┘ └──────┬──────┘
       │                │                │
       └────────────────┼────────────────┘
                        │
              ┌─────────▼─────────┐
              │   Message Broker  │
              │  (RabbitMQ/Kafka) │
              └───────────────────┘
```
